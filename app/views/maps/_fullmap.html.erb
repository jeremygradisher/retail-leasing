<div id='map' class="mapshowmap" style="height:464px;"></div>

<script>
	//A Leaflet map has one CRS (and one CRS only), that can be changed when creating the map. 
	//In a CRS.Simple, one horizontal map unit is mapped to one horizontal pixel, 
	<% if @image.height.to_i > 10000 %>
	var map = L.map('map', {attributionControl: false, crs: L.CRS.Simple, zoomSnap: 0.25, minZoom: -6});
	<% elsif @image.height.to_i > 5000 && @image.height.to_i <= 10000 %>
	var map = L.map('map', {attributionControl: false, crs: L.CRS.Simple, zoomSnap: 0.25, minZoom: -5});
	<% elsif @image.height.to_i > 2500 && @image.height.to_i <= 5000 %>
	var map = L.map('map', {attributionControl: false, crs: L.CRS.Simple, zoomSnap: 0.25, minZoom: -4});
	<% else %>
	var map = L.map('map', {attributionControl: false, crs: L.CRS.Simple, zoomSnap: 0.25, minZoom: -3});
	<% end %>

	var attributionInfo = L.control.attribution({prefix: '<span class="AttributionClass">Map: <%= link_to @map.name, map_path(@map) %> | <%= @image.width.to_i %>w, <%= @image.height.to_i %>h</span>'}).addTo(map);


	//If working with [y, x] coordinates with something named L.LatLng doesnâ€™t make much sense to you, 
	//you can easily create wrappers for them:
	var yx = L.latLng;

	var xy = function(x, y) {
		if (L.Util.isArray(x)) {    // When doing xy([x, y]);
			return yx(x[1], x[0]);
		}
		return yx(y, x);  // When doing xy(x, y);
	};

	//Then we can just add a L.ImageOverlay with the starmap image and its approximate bounds:

	var bounds = [xy(0,0), xy(<%= @image.width %>,<%= @image.height %>)];

	var image = L.imageOverlay('<%= @image.image_url %>', bounds).addTo(map);
	
	
	//this will set map initially with whole map showing
	//map.setView(xy(120, 70), 1);
	
    //this will set map initially with it zoomed up to natural image size
    //map.fitBounds(bounds);
    
    //this checks image size and then sets map slightly zoomed in on image
    <% if @image.width.to_i > 10000 %>
        map.setView(xy(<%= @image.width.to_i/2 %>, <%= @image.height.to_i/2 %>), -5);
    <% elsif @image.width.to_i > 5000 && @image.width.to_i <= 10000 %>
        map.setView(xy(<%= @image.width.to_i/2 %>, <%= @image.height.to_i/2 %>), -3);
    <% elsif @image.width.to_i > 2500 && @image.width.to_i <= 5000 %>
        map.setView(xy(<%= @image.width.to_i/2 %>, <%= @image.height.to_i/2 %>), -1.5);
    <% else %>
        map.setView(xy(<%= @image.width.to_i/2 %>, <%= @image.height.to_i/2 %>), .25);
    <% end %>
    
    // Restrict view to bounds
	//map.setMaxBounds(bounds);

    var popup = L.popup();
    
    //same on all maps - Now we can create our icons from this class and use them:
    <%= render 'areas/marker_variables' %>
    
    var leasingStatus = L.layerGroup();
    var areaStatus = L.layerGroup();
    var openingStatus = L.layerGroup();
    var merchandisingStatus = L.layerGroup();
    
    //this does all for the leasing now
    <% @mapareas.each do |area| %>//1. areas of primary map each
        <% if area.deals.load.any? %>//2. if there is a deal
    	    <% if Deal.where(id: area.primary_deal.to_i).exists? %>//3. if a primary deal exists
    	        var <%= 'd' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                //primaryDeal <%#= area.deals.find(area.primary_deal.to_i) %>
                L.geoJson(<%= 'd' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.deals.find(area.primary_deal.to_i).lease_status == 'Available' %>icon: c_d13e27Icon<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'Prospect' %>icon: c_e5ba21Icon<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'LOI'  %>icon: c_f16528Icon<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'At Lease'  %>icon: c_15958aIcon<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'Leased'  %>icon: c_8bc53fIcon<% else %>icon: grayIcon <% end %>});
                }}).addTo(leasingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.deals.find(area.primary_deal.to_i).deal_name, area_path(area) %></strong><% if area.deals.size > 1 %><span style="color:#8BC53F;"><%= link_to "Multiple Deals: (" + area.deals.size.to_s + ")", area_path(area), :style => 'color:#8bc53f;float:right;margin-right:12px;' %></span><% end %></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><% if area.deals.find(area.primary_deal.to_i).dealimages.blank? %><%= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% else %><%= link_to image_tag(area.deals.find(area.primary_deal.to_i).dealimages.first.dealimage_url, :style => 'width:100% !important;float:left;'), area_path(area) %><% end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Lease Status: <%= area.deals.find(area.primary_deal.to_i).lease_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
            	<% if area.deals.find(area.primary_deal.to_i).lease_status == 'Available' %>fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'Prospect' %>fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'LOI' %>fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'At Lease' %>fillColor: '#15958A', color: '#15958A', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).lease_status == 'Leased' %>fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
            <% else %>//3. if a primary deal does not exist
                var <%= 'd' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                L.geoJson(<%= 'd' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.deals.first.lease_status == 'Available' %>icon: c_d13e27Icon<% elsif area.deals.first.lease_status == 'Prospect' %>icon: c_e5ba21Icon<% elsif area.deals.first.lease_status == 'LOI'  %>icon: c_f16528Icon<% elsif area.deals.first.lease_status == 'At Lease'  %>icon: c_15958aIcon<% elsif area.deals.first.lease_status == 'Leased'  %>icon: c_8bc53fIcon<% else %>icon: grayIcon <% end %>});
                }}).addTo(leasingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.deals.first.deal_name, area_path(area) %></strong><% if area.deals.size > 1 %><span style="color:#8BC53F;"><%= link_to "Multiple Deals: (" + area.deals.size.to_s + ")", area_path(area), :style => 'color:#8bc53f;float:right;margin-right:12px;' %></span><% end %></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><% if area.deals.first.dealimages.blank? %><%= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% else %><%= link_to image_tag(area.deals.first.dealimages.first.dealimage_url, :style => 'width:100% !important;float:left;'), area_path(area) %><% end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Lease Status: <% if area.deals.first.present? %><%= area.deals.first.lease_status %><% end %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
            	<% if area.deals.first.lease_status == 'Available' %>fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.lease_status == 'Prospect' %>fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.lease_status == 'LOI' %>fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.lease_status == 'At Lease' %>fillColor: '#15958A', color: '#15958A', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.lease_status == 'Leased' %>fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
            <% end %>//3. end if a primary deal exists
        <% else %>//2. else if there isn't a deal
                var <%= 'd' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
    
                L.geoJson(<%= 'd' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.lease_status == 'Available' %>icon: c_d13e27Icon<% elsif area.lease_status == 'Prospect' %>icon: c_e5ba21Icon<% elsif area.lease_status == 'LOI'  %>icon: c_f16528Icon<% elsif area.lease_status == 'At Lease'  %>icon: c_15958aIcon<% elsif area.lease_status == 'Leased'  %>icon: c_8bc53fIcon<% else %>icon: grayIcon <% end %>});
                }}).addTo(leasingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to 'No Deal for Area', area_path(area) %></strong><% if area.deals.size > 1 %><span style="color:#8BC53F;"><%= link_to "Multiple Deals: (" + area.deals.size.to_s + ")", area_path(area), :style => 'color:#8bc53f;float:right;margin-right:12px;' %></span><% end %></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><% if area.areaimages.blank? && area.area_status == '01 Available' %><%= link_to image_tag('/images/available.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% elsif area.areaimages.blank? && area.area_status != '01 Available'  %><%= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% else %><% area.areaimages.each do |p| %><%= link_to image_tag(p.areaimage_url, :style => 'width:100% !important;float:left;'), area_path(area) %><% end %><% end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Lease Status: <% if area.present? %><%= area.lease_status %><% end %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
            	<% if area.lease_status == 'Available' %>fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.lease_status == 'Prospect' %>fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.lease_status == 'LOI' %>fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.lease_status == 'At Lease' %>fillColor: '#15958A', color: '#15958A', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.lease_status == 'Leased' %>fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
		<% end %>//2. END if there is/isn't a deal
    <% end %>//1. END areas of primary map each
    
    //this does the deal/area if there is a primary deal selected (before I consolidated above)
    //just leaving as an example without all of the logic
    <%# @deals.each do |deal| %>
        <%# if deal.id == deal.area.primary_deal.to_i %>
            //var <%#= 'dd' + deal.id.to_s + deal.deal_name.gsub(/\W\s?/, "") %> = <%#= deal.area.coords.html_safe %>;
            
            //L.geoJson(<%#= 'dd' + deal.id.to_s + deal.deal_name.gsub(/\W\s?/, "") %>, {
            //pointToLayer: function (feature, latlng) {
            //return L.marker(latlng, {<%# if deal.lease_status == 'Available' %>icon: c_d13e27Icon<%# elsif deal.lease_status == 'Prospect' %>icon: c_e5ba21Icon<%# elsif deal.lease_status == 'LOI'  %>icon: c_f16528Icon<%# elsif deal.lease_status == 'At Lease'  %>icon: c_15958aIcon<%# elsif deal.lease_status == 'Leased'  %>icon: c_8bc53fIcon<%# else %>icon: grayIcon <%# end %>});
            //}}).addTo(leasingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><%# if deal.area.name.blank? %><strong><%#= link_to 'Untitled Area', area_path(deal.area) %></strong><%# else %><strong><%#= link_to deal.area.name, area_path(deal.area) %></strong><%# end %></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><%# if deal.area.areaimages.blank? && deal.area.area_status == '01 Available' %><%#= link_to image_tag('/images/available.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(deal.area) %><%# elsif deal.area.areaimages.blank? && deal.area.area_status != '01 Available'  %><%#= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(deal.area) %><%# else %><%# deal.area.areaimages.each do |p| %><%#= link_to image_tag(p.areaimage_url, :style => 'width:100% !important;float:left;'), area_path(deal.area) %><%# end %><%# end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%#= deal.area.suite_number %><br>Sq ft: <%#= number_with_delimiter(deal.area.area_square_feet, :delimiter => ',') %><br>Status: <%#= deal.lease_status %><br><%#= link_to "More Info...", area_path(deal.area) %></p></div><br style="clear:both;"></div>').setStyle({
        	//<%# if deal.lease_status == 'Available' %>'className': 'opening-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<%# elsif deal.lease_status == 'Prospect' %>'className': 'opening-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<%# elsif deal.lease_status == 'LOI' %>'className': 'opening-status-color', fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<%# elsif deal.lease_status == 'At Lease' %>'className': 'opening-status-color', fillColor: '#15958A', color: '#15958A', weight: 1, opacity: 0.8, fillOpacity: 0.8<%# elsif deal.lease_status == 'Leased' %>'className': 'opening-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<%# else %>'className': 'opening-status-color', fillColor: '#ddd', color: '#ddd', weight: 1, opacity: 0.8, fillOpacity: 0.8<%# end %>});
    	<%# end %>	
    <%# end %>
    
	<% @mapareas.each do |area| #1 areasof primary map each for Tenant Corrdination %>
    	<% if area.deals.any? #2. if there is a deal %>
        	<% if Deal.where(id: area.primary_deal.to_i).exists? #3 if a primary deal exists %>
                var <%= 's' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                
                L.geoJson(<%= 's' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.area_status == '01 Available' %>icon: availableIcon<% elsif area.area_status == '02 Lease Negotiation' %>icon: leasenegotiationIcon<% elsif area.area_status == '03 Landlord Construction'  %>icon: llconstructionIcon<% elsif area.area_status == '04 Tenant Design'  %>icon: tenantdesignIcon<% elsif area.area_status == '05 Tenant Fit-Out'  %>icon: tenantfitoutIcon<% elsif area.area_status == '06 Open for Business'  %>icon: openIcon<% elsif area.area_status == '07 Close-Out'  %>icon: closeoutIcon<% elsif area.area_status == '08 Operating'  %>icon: operatingIcon<% else %>icon: lblueIcon <% end %>});
                }}).addTo(areaStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to Deal.find(area.primary_deal.to_i).deal_name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:right;width:100%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Tenant Status: <%= area.area_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
        		<% if area.area_status == '01 Available' %>'className': 'area-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '02 Lease Negotiation' %>'className': 'area-status-color', fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '03 Landlord Construction' %>'className': 'area-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '04 Tenant Design' %>'className': 'area-status-color', fillColor: '#24b9ae', color: '#24b9ae', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '05 Tenant Fit-Out' %>'className': 'area-status-color', fillColor: '#c9e1f7', color: '#c9e1f7', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '06 Open for Business' %>'className': 'area-status-color', fillColor: '#346db5', color: '#346db5', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '07 Close-Out' %>'className': 'area-status-color', fillColor: '#6e4a86', color: '#561871', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '08 Operating' %>'className': 'area-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>'className': 'area-status-color', fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
            
            <% else #3 if a primary deal does not exist %>
                var <%= 's' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                
                L.geoJson(<%= 's' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.area_status == '01 Available' %>icon: availableIcon<% elsif area.area_status == '02 Lease Negotiation' %>icon: leasenegotiationIcon<% elsif area.area_status == '03 Landlord Construction'  %>icon: llconstructionIcon<% elsif area.area_status == '04 Tenant Design'  %>icon: tenantdesignIcon<% elsif area.area_status == '05 Tenant Fit-Out'  %>icon: tenantfitoutIcon<% elsif area.area_status == '06 Open for Business'  %>icon: openIcon<% elsif area.area_status == '07 Close-Out'  %>icon: closeoutIcon<% elsif area.area_status == '08 Operating'  %>icon: operatingIcon<% else %>icon: lblueIcon <% end %>});
                }}).addTo(areaStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.deals.first.deal_name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:right;width:100%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Tenant Status: <%= area.area_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
        		<% if area.area_status == '01 Available' %>'className': 'area-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '02 Lease Negotiation' %>'className': 'area-status-color', fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '03 Landlord Construction' %>'className': 'area-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '04 Tenant Design' %>'className': 'area-status-color', fillColor: '#24b9ae', color: '#24b9ae', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '05 Tenant Fit-Out' %>'className': 'area-status-color', fillColor: '#c9e1f7', color: '#c9e1f7', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '06 Open for Business' %>'className': 'area-status-color', fillColor: '#346db5', color: '#346db5', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '07 Close-Out' %>'className': 'area-status-color', fillColor: '#6e4a86', color: '#561871', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '08 Operating' %>'className': 'area-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>'className': 'area-status-color', fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
            <% end #3 End if there is/isn't a primary deal %>
        <% else #2 if there isn't a deal %>
            var <%= 's' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
            
            L.geoJson(<%= 's' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
            pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {<% if area.area_status == '01 Available' %>icon: availableIcon<% elsif area.area_status == '02 Lease Negotiation' %>icon: leasenegotiationIcon<% elsif area.area_status == '03 Landlord Construction'  %>icon: llconstructionIcon<% elsif area.area_status == '04 Tenant Design'  %>icon: tenantdesignIcon<% elsif area.area_status == '05 Tenant Fit-Out'  %>icon: tenantfitoutIcon<% elsif area.area_status == '06 Open for Business'  %>icon: openIcon<% elsif area.area_status == '07 Close-Out'  %>icon: closeoutIcon<% elsif area.area_status == '08 Operating'  %>icon: operatingIcon<% else %>icon: lblueIcon <% end %>});
            }}).addTo(areaStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:right;width:100%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Tenant Status: <%= area.area_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
    		<% if area.area_status == '01 Available' %>'className': 'area-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '02 Lease Negotiation' %>'className': 'area-status-color', fillColor: '#f15b28', color: '#f15b28', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '03 Landlord Construction' %>'className': 'area-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '04 Tenant Design' %>'className': 'area-status-color', fillColor: '#24b9ae', color: '#24b9ae', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '05 Tenant Fit-Out' %>'className': 'area-status-color', fillColor: '#c9e1f7', color: '#c9e1f7', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '06 Open for Business' %>'className': 'area-status-color', fillColor: '#346db5', color: '#346db5', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '07 Close-Out' %>'className': 'area-status-color', fillColor: '#6e4a86', color: '#561871', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.area_status == '08 Operating' %>'className': 'area-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>'className': 'area-status-color', fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
        <% end #2 END if there is a deal%>
    <% end #1 END areasofprimary map each %>
    
    
    
	<% @mapareas.each do |area| #1 mapareas from project for opening status %>
    	<% if area.deals.any? %>//2. if there is a deal
        	<% if Deal.where(id: area.primary_deal.to_i).exists? %>//3. if area has primary deal and it exists
                var <%= 'o' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                
                L.geoJson(<%= 'o' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.opening_status == 'No' %>icon: noIcon<% elsif area.opening_status == 'Challenged' %>icon: challengedIcon<% elsif area.opening_status == 'Yes'  %>icon: yesIcon<% else %>icon: lblueIcon <% end %>});
                }}).addTo(openingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to Deal.find(area.primary_deal.to_i).deal_name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:right;width:100%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Opening Status: <%= area.opening_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
            	<% if area.opening_status == 'No' %>'className': 'opening-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.opening_status == 'Challenged' %>'className': 'opening-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.opening_status == 'Yes' %>'className': 'opening-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>'className': 'opening-status-color', fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
        	<% else %>//3. else if area doesn't have a primary deal
                var <%= 'o' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                
                L.geoJson(<%= 'o' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.opening_status == 'No' %>icon: noIcon<% elsif area.opening_status == 'Challenged' %>icon: challengedIcon<% elsif area.opening_status == 'Yes'  %>icon: yesIcon<% else %>icon: lblueIcon <% end %>});
                }}).addTo(openingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;">*No Primary Deal Selected</p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:right;width:100%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Opening Status: <%= area.opening_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
            	<% if area.opening_status == 'No' %>'className': 'opening-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.opening_status == 'Challenged' %>'className': 'opening-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.opening_status == 'Yes' %>'className': 'opening-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>'className': 'opening-status-color', fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
        	<% end %>//3. end if primary deal
    	<% else %>//2. else if there isn't a deal
            var <%= 'o' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
            
            L.geoJson(<%= 'o' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
            pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {<% if area.opening_status == 'No' %>icon: noIcon<% elsif area.opening_status == 'Challenged' %>icon: challengedIcon<% elsif area.opening_status == 'Yes'  %>icon: yesIcon<% else %>icon: lblueIcon <% end %>});
            }}).addTo(openingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:right;width:100%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Opening Status: <%= area.opening_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({
        	<% if area.opening_status == 'No' %>'className': 'opening-status-color', fillColor: '#D13E27', color: '#D13E27', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.opening_status == 'Challenged' %>'className': 'opening-status-color', fillColor: '#dddd4e', color: '#dddd4e', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.opening_status == 'Yes' %>'className': 'opening-status-color', fillColor: '#8BC53F', color: '#8BC53F', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>'className': 'opening-status-color', fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
    	
    	<% end %>//2. end if there is/isn't a deal
    <% end %>
    
    <% @mapareas.each do |area| %>//1. mapareas merch status
        <% if area.deals.any? %>//2. if there is a deal
            <% if Deal.where(id: area.primary_deal.to_i).exists? %>//3. if area has primary deal and it exists
                var <%= 'm' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                //TestTest
                
                
                L.geoJson(<%= 'm' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.deals.find(area.primary_deal.to_i).merchandising_status == 'Auto / Gas' %>icon: c_66635fIcon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Candy / Confectionary' %>icon: c_f9ef7bIcon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Department Store'  %>icon: c_fed389Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Electronics' %>icon: c_be8b67Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Entertainment'  %>icon: c_e62536Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Fashion' %>icon: c_67a5d7Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Food & Beverage'  %>icon: c_f7b131Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Footwear'  %>icon: c_388b00Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Grocery / Hypermarket' %>icon: c_b6cf42Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Home / Furnishings'  %>icon: c_f38a7cIcon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Jewelry / Handbags' %>icon: c_a6749cIcon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Mobiles / Accessories'  %>icon: c_3a63a8Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Perfume / Cosmetics' %>icon: c_ec4f92Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Pets'  %>icon: c_e29423Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Services / Specialty Stores' %>icon: c_efa1c5Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Sports / Outdoor / Fitness'  %>icon: c_7ca180Icon<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Toys & Hobbies / Gifts / Books' %>icon: c_b2cce9Icon<% else %>icon: lblueIcon <% end %>});
                }}).addTo(merchandisingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.deals.find(area.primary_deal.to_i).deal_name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><% if area.deals.find(area.primary_deal.to_i).dealimages.load.blank? %><%= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% else %><%= link_to image_tag(area.deals.find(area.primary_deal.to_i).dealimages.first.dealimage_url, :style => 'width:100% !important;float:left;'), area_path(area) %><% end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Merchandising: <%= area.deals.find(area.primary_deal.to_i).merchandising_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({<% if area.deals.find(area.primary_deal.to_i).merchandising_status == 'Auto / Gas' %>fillColor: '#66635f', color: '#66635f', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Candy / Confectionary' %>fillColor: '#f9ef7b', color: '#f9ef7b', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Department Store' %>fillColor: '#fed389', color: '#fed389', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Electronics' %>fillColor: '#be8b67', color: '#be8b67', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Entertainment' %>fillColor: '#e62536', color: '#e62536', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Fashion' %>fillColor: '#67a5d7', color: '#67a5d7', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Food & Beverage' %>fillColor: '#f7b131', color: '#f7b131', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Footwear' %>fillColor: '#388b00', color: '#388b00', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Grocery / Hypermarket' %>fillColor: '#b6cf42', color: '#b6cf42', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Home / Furnishings' %>fillColor: '#f38a7c', color: '#f38a7c', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Jewelry / Handbags' %>fillColor: '#a6749c', color: '#a6749c', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Mobiles / Accessories' %>fillColor: '#3a63a8', color: '#3a63a8', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Perfume / Cosmetics' %>fillColor: '#ec4f92', color: '#ec4f92', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Pets' %>fillColor: '#e29423', color: '#e29423', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Services / Specialty Stores' %>fillColor: '#efa1c5', color: '#efa1c5', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Sports / Outdoor / Fitness' %>fillColor: '#7ca180', color: '#7ca180', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.find(area.primary_deal.to_i).merchandising_status == 'Toys & Hobbies / Gifts / Books' %>fillColor: '#b2cce9', color: '#b2cce9', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
       	   
       	   <% else %>//3. else if area doesn't have a primary deal
       	        var <%= 'm' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
                //TestTestTest
                
                L.geoJson(<%= 'm' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
                pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {<% if area.deals.first.merchandising_status == 'Auto / Gas' %>icon: c_66635fIcon<% elsif area.deals.first.merchandising_status == 'Candy / Confectionary' %>icon: c_f9ef7bIcon<% elsif area.deals.first.merchandising_status == 'Department Store'  %>icon: c_fed389Icon<% elsif area.deals.first.merchandising_status == 'Electronics' %>icon: c_be8b67Icon<% elsif area.deals.first.merchandising_status == 'Entertainment'  %>icon: c_e62536Icon<% elsif area.deals.first.merchandising_status == 'Fashion' %>icon: c_67a5d7Icon<% elsif area.deals.first.merchandising_status == 'Food & Beverage'  %>icon: c_f7b131Icon<% elsif area.deals.first.merchandising_status == 'Footwear'  %>icon: c_388b00Icon<% elsif area.deals.first.merchandising_status == 'Grocery / Hypermarket' %>icon: c_b6cf42Icon<% elsif area.deals.first.merchandising_status == 'Home / Furnishings'  %>icon: c_f38a7cIcon<% elsif area.deals.first.merchandising_status == 'Jewelry / Handbags' %>icon: c_a6749cIcon<% elsif area.deals.first.merchandising_status == 'Mobiles / Accessories'  %>icon: c_3a63a8Icon<% elsif area.deals.first.merchandising_status == 'Perfume / Cosmetics' %>icon: c_ec4f92Icon<% elsif area.deals.first.merchandising_status == 'Pets'  %>icon: c_e29423Icon<% elsif area.deals.first.merchandising_status == 'Services / Specialty Stores' %>icon: c_efa1c5Icon<% elsif area.deals.first.merchandising_status == 'Sports / Outdoor / Fitness'  %>icon: c_7ca180Icon<% elsif area.deals.first.merchandising_status == 'Toys & Hobbies / Gifts / Books' %>icon: c_b2cce9Icon<% else %>icon: lblueIcon <% end %>});
                }}).addTo(merchandisingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to Deal.find(area.deals.first).deal_name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><% if area.deals.first.dealimages.load.blank? %><%= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% else %><%= link_to image_tag(area.deals.first.dealimages.first.dealimage_url, :style => 'width:100% !important;float:left;'), area_path(area) %><% end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Merchandising: <%= area.deals.first.merchandising_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({<% if area.deals.first.merchandising_status == 'Auto / Gas' %>fillColor: '#66635f', color: '#66635f', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Candy / Confectionary' %>fillColor: '#f9ef7b', color: '#f9ef7b', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Department Store' %>fillColor: '#fed389', color: '#fed389', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Electronics' %>fillColor: '#be8b67', color: '#be8b67', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Entertainment' %>fillColor: '#e62536', color: '#e62536', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Fashion' %>fillColor: '#67a5d7', color: '#67a5d7', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Food & Beverage' %>fillColor: '#f7b131', color: '#f7b131', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Footwear' %>fillColor: '#388b00', color: '#388b00', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Grocery / Hypermarket' %>fillColor: '#b6cf42', color: '#b6cf42', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Home / Furnishings' %>fillColor: '#f38a7c', color: '#f38a7c', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Jewelry / Handbags' %>fillColor: '#a6749c', color: '#a6749c', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Mobiles / Accessories' %>fillColor: '#3a63a8', color: '#3a63a8', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Perfume / Cosmetics' %>fillColor: '#ec4f92', color: '#ec4f92', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Pets' %>fillColor: '#e29423', color: '#e29423', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Services / Specialty Stores' %>fillColor: '#efa1c5', color: '#efa1c5', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Sports / Outdoor / Fitness' %>fillColor: '#7ca180', color: '#7ca180', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.deals.first.merchandising_status == 'Toys & Hobbies / Gifts / Books' %>fillColor: '#b2cce9', color: '#b2cce9', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
       	    
       	    <% end %>//3. end if primary deal
       	<% else %>//2. else if there isn't a deal
    	    var <%= 'm' + area.id.to_s + area.name.gsub(/\W\s?/, "") %> = <%= area.coords.html_safe %>;
            
            L.geoJson(<%= 'm' + area.id.to_s + area.name.gsub(/\W\s?/, "") %>, {
            pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {<% if area.merchandising_status == 'Auto / Gas' %>icon: c_66635fIcon<% elsif area.merchandising_status == 'Candy / Confectionary' %>icon: c_f9ef7bIcon<% elsif area.merchandising_status == 'Department Store'  %>icon: c_fed389Icon<% elsif area.merchandising_status == 'Electronics' %>icon: c_be8b67Icon<% elsif area.merchandising_status == 'Entertainment'  %>icon: c_e62536Icon<% elsif area.merchandising_status == 'Fashion' %>icon: c_67a5d7Icon<% elsif area.merchandising_status == 'Food & Beverage'  %>icon: c_f7b131Icon<% elsif area.merchandising_status == 'Footwear'  %>icon: c_388b00Icon<% elsif area.merchandising_status == 'Grocery / Hypermarket' %>icon: c_b6cf42Icon<% elsif area.merchandising_status == 'Home / Furnishings'  %>icon: c_f38a7cIcon<% elsif area.merchandising_status == 'Jewelry / Handbags' %>icon: c_a6749cIcon<% elsif area.merchandising_status == 'Mobiles / Accessories'  %>icon: c_3a63a8Icon<% elsif area.merchandising_status == 'Perfume / Cosmetics' %>icon: c_ec4f92Icon<% elsif area.merchandising_status == 'Pets'  %>icon: c_e29423Icon<% elsif area.merchandising_status == 'Services / Specialty Stores' %>icon: c_efa1c5Icon<% elsif area.merchandising_status == 'Sports / Outdoor / Fitness'  %>icon: c_7ca180Icon<% elsif area.merchandising_status == 'Toys & Hobbies / Gifts / Books' %>icon: c_b2cce9Icon<% else %>icon: lblueIcon <% end %>});
            }}).addTo(merchandisingStatus).bindPopup('<div style="width:300px;"><p style="margin-top:0;margin-bottom:4px;"><strong><%= link_to area.name, area_path(area) %></strong></p><hr style="margin-top:0;margin-bottom:6px;"><div style="float:left;width:48%;"><% if area.areaimages.blank? && area.area_status == '01 Available' %><%= link_to image_tag('/images/available.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% elsif area.areaimages.blank? && area.area_status != '01 Available'  %><%= link_to image_tag('/images/status-plan-logo.png', :style => 'width:100% !important;float:left;margin-top:20px;margin-bottom:20px;'), area_path(area) %><% else %><% area.areaimages.each do |p| %><%= link_to image_tag(p.areaimage_url, :style => 'width:100% !important;float:left;'), area_path(area) %><% end %><% end %></div><div style="float:right;width:48%;"><p style="margin-top:4px;margin-bottom:4px;">Suite #: <%= area.suite_number %><br>Sq ft: <%= number_with_delimiter(area.area_square_feet, :delimiter => ',') %><br>Merchandising: <%= area.merchandising_status %><br><%= link_to "More Info...", area_path(area) %></p></div><br style="clear:both;"></div>').setStyle({<% if area.merchandising_status == 'Auto / Gas' %>fillColor: '#66635f', color: '#66635f', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Candy / Confectionary' %>fillColor: '#f9ef7b', color: '#f9ef7b', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Department Store' %>fillColor: '#fed389', color: '#fed389', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Electronics' %>fillColor: '#be8b67', color: '#be8b67', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Entertainment' %>fillColor: '#e62536', color: '#e62536', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Fashion' %>fillColor: '#67a5d7', color: '#67a5d7', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Food & Beverage' %>fillColor: '#f7b131', color: '#f7b131', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Footwear' %>fillColor: '#388b00', color: '#388b00', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Grocery / Hypermarket' %>fillColor: '#b6cf42', color: '#b6cf42', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Home / Furnishings' %>fillColor: '#f38a7c', color: '#f38a7c', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Jewelry / Handbags' %>fillColor: '#a6749c', color: '#a6749c', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Mobiles / Accessories' %>fillColor: '#3a63a8', color: '#3a63a8', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Perfume / Cosmetics' %>fillColor: '#ec4f92', color: '#ec4f92', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Pets' %>fillColor: '#e29423', color: '#e29423', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Services / Specialty Stores' %>fillColor: '#efa1c5', color: '#efa1c5', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Sports / Outdoor / Fitness' %>fillColor: '#7ca180', color: '#7ca180', weight: 1, opacity: 0.8, fillOpacity: 0.8<% elsif area.merchandising_status == 'Toys & Hobbies / Gifts / Books' %>fillColor: '#b2cce9', color: '#b2cce9', weight: 1, opacity: 0.8, fillOpacity: 0.8<% else %>fillColor: '#dd0000', color: '#dd0000', weight: 1, opacity: 0.8, fillOpacity: 0.8<% end %>});
    	<% end %>//2. end if there is/isn't a deal
    <% end %>//1. END mapareas merch status    

    
    leasingStatus.addTo(map);
    //areaStatus.addTo(map);
    //openingStatus.addTo(map);
    //merchandisingStatus.addTo(map);

</script>